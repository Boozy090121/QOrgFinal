<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCI Quality Organization Dashboard - Personnel Management</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="personnel-drag.css">
    <link rel="stylesheet" href="personnel-layout.css">
</head>
<body>
    <div class="navbar">
        <h1>PCI Quality Dashboard</h1>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="factory1.html">Organization</a>
            <a href="personnel-drag.html" class="active">Personnel</a>
            <a href="timeline.html">Timeline</a>
            <a href="budget.html">Budget</a>
            <a href="resources.html">Resources</a>
        </div>
    </div>
    
    <div class="container">
        <div class="personnel-sidebar" id="personnelSidebar">
            <!-- Personnel list will be rendered here -->
        </div>
        
        <div class="org-chart-container" id="orgChartContainer">
            <!-- Org chart will be rendered here -->
        </div>
    </div>
    
    <script src="personnel-data.js"></script>
    <script src="personnel-list.js"></script>
    <script src="org-chart.js"></script>
    <script src="drag-drop-manager.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the personnel manager
            const personnelManager = new PersonnelManager();
            
            // Try to load data from localStorage
            const dataLoaded = personnelManager.loadFromLocalStorage();
            
            // If no data was loaded, use default data
            if (!dataLoaded) {
                personnelManager.resetToDefault();
                personnelManager.saveToLocalStorage();
            }
            
            // Initialize the personnel list component
            const personnelList = new PersonnelListComponent('personnelSidebar', personnelManager);
            
            // Initialize the org chart component
            const orgChart = new OrgChartComponent('orgChartContainer', personnelManager);
            
            // Initialize the drag and drop manager
            const dragDropManager = new DragDropManager(personnelManager);
            
            // Add event listener for DOM changes to refresh drag and drop
            const observer = new MutationObserver(() => {
                dragDropManager.refresh();
            });
            
            // Observe both containers for changes
            observer.observe(document.getElementById('personnelSidebar'), { 
                childList: true, 
                subtree: true 
            });
            
            observer.observe(document.getElementById('orgChartContainer'), { 
                childList: true, 
                subtree: true 
            });
            
            // Add keyboard accessibility
            document.addEventListener('keydown', function(e) {
                // Escape key closes any open modals
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });
            
            // Add window resize handler to ensure layout is optimized
            window.addEventListener('resize', function() {
                // Adjust layout for presentation if needed
                const container = document.querySelector('.container');
                if (window.innerWidth < 768) {
                    container.style.flexDirection = 'column';
                } else {
                    container.style.flexDirection = 'row';
                }
            });
            
            // Trigger resize handler on load
            window.dispatchEvent(new Event('resize'));
            
            // Log initialization complete
            console.log('Personnel Management System initialized successfully');
        });
    </script>
</body>
</html>
